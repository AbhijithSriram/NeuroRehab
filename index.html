<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>VR Ball Catching Game - Button Controls</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>
<body>
    <a-scene background="color: #87CEEB" vr-mode-ui="enabled: true">
        <!-- Environment -->
        <a-plane position="0 0 -4" rotation="-90 0 0" width="10" height="10" color="#90EE90"></a-plane>
        
        <!-- Lighting -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="2 4 2" color="#ffffff"></a-light>

        <!-- Game UI -->
        <a-text id="score-text" position="0 3.2 -3" value="Score: 0/10" color="black" align="center" width="8"></a-text>
        <a-text id="round-text" position="0 3.6 -3" value="Round 1" color="black" align="center" width="6"></a-text>
        
        <!-- Side indicators -->
        <a-text id="left-indicator" position="-2.5 2.8 -3" value="LEFT SIDE\n(Press G)" color="blue" align="center" width="4"></a-text>
        <a-text id="right-indicator" position="2.5 2.8 -3" value="RIGHT SIDE\n(Press H)" color="red" align="center" width="4"></a-text>

        <!-- Instructions -->
        <a-text id="instruction-text" position="0 2.2 -3" 
                value="Watch the ball! Press G for left balls, H for right balls!" 
                color="darkgreen" align="center" width="5"></a-text>

        <!-- Feedback text -->
        <a-text id="feedback-text" position="0 1.8 -3" value="" color="orange" align="center" width="6"></a-text>

        <!-- VR Controllers (for VR mode) -->
        <a-entity id="leftHand" hand-controls="hand: left" laser-controls visible="false"></a-entity>
        <a-entity id="rightHand" hand-controls="hand: right" laser-controls visible="false"></a-entity>

        <!-- Camera -->
        <a-entity id="rig" movement-controls position="0 1.6 1">
            <a-camera look-controls></a-camera>
        </a-entity>

        <!-- Game Manager -->
        <a-entity id="gameManager" game-logic></a-entity>
    </a-scene>

    <script>
        // Game state
        let gameState = {
            score: 0,
            round: 1,
            ballsThrown: 0,
            totalBalls: 10,
            gameActive: true,
            currentBall: null,
            currentBallSide: null, // 'left' or 'right'
            ballActive: false
        };

        // Game logic component
        AFRAME.registerComponent('game-logic', {
            init: function() {
                console.log('Game starting...');
                this.startGame();
                this.setupKeyboardControls();
            },

            setupKeyboardControls: function() {
                document.addEventListener('keydown', (event) => {
                    if (!gameState.ballActive || !gameState.currentBall) return;

                    const key = event.key.toLowerCase();
                    let correctKey = false;

                    if (key === 'g' && gameState.currentBallSide === 'left') {
                        correctKey = true;
                    } else if (key === 'h' && gameState.currentBallSide === 'right') {
                        correctKey = true;
                    }

                    if (correctKey) {
                        this.catchBall(gameState.currentBall, true);
                    } else if (key === 'g' || key === 'h') {
                        this.wrongButton();
                    }
                });
            },

            startGame: function() {
                this.showFeedback("Get ready...", "blue");
                setTimeout(() => {
                    this.spawnBall();
                }, 2000);
            },

            spawnBall: function() {
                if (gameState.ballsThrown >= gameState.totalBalls) {
                    this.endRound();
                    return;
                }

                console.log('Spawning ball', gameState.ballsThrown + 1);

                // Random side selection
                const isLeft = Math.random() < 0.5;
                gameState.currentBallSide = isLeft ? 'left' : 'right';
                const xPos = isLeft ? -2.5 : 2.5;

                // Create ball
                const ball = document.createElement('a-sphere');
                ball.setAttribute('position', `${xPos} 2.5 -2`);
                ball.setAttribute('radius', '0.15');
                
                // Color based on side
                const ballColor = isLeft ? '#4444ff' : '#ff4444'; // Blue for left, Red for right
                ball.setAttribute('color', ballColor);
                ball.setAttribute('id', `ball-${gameState.ballsThrown}`);

                // Add to scene
                document.querySelector('a-scene').appendChild(ball);

                // Set current ball
                gameState.currentBall = ball;
                gameState.ballActive = true;

                // Show which key to press
                const keyToPress = isLeft ? 'G' : 'H';
                const sideText = isLeft ? 'LEFT' : 'RIGHT';
                this.showFeedback(`${sideText} BALL - Press ${keyToPress}!`, isLeft ? 'blue' : 'red');

                // Animate ball movement toward player
                ball.setAttribute('animation', {
                    property: 'position',
                    to: `${xPos * 0.3} 1.6 -0.5`,
                    dur: 3000,
                    easing: 'linear'
                });

                gameState.ballsThrown++;
                this.updateUI();

                // Ball expires after 3.5 seconds if not caught
                setTimeout(() => {
                    if (ball.parentNode && gameState.ballActive) {
                        this.missedBall(ball);
                    }
                }, 3500);
            },

            catchBall: function(ball, wasCorrect = false) {
                if (!gameState.ballActive) return;

                console.log('Ball caught correctly!');
                gameState.ballActive = false;
                
                // Visual feedback
                ball.setAttribute('color', '#44ff44'); // Green for success
                ball.setAttribute('animation', {
                    property: 'scale',
                    to: '0.5 0.5 0.5',
                    dur: 300
                });

                if (wasCorrect) {
                    gameState.score++;
                    this.showFeedback('CAUGHT! +1 point', 'green');
                } else {
                    this.showFeedback('Missed timing!', 'orange');
                }

                this.updateUI();

                // Remove ball
                setTimeout(() => {
                    if (ball.parentNode) {
                        ball.parentNode.removeChild(ball);
                    }
                }, 300);

                this.nextBall();
            },

            wrongButton: function() {
                if (!gameState.ballActive) return;

                const correctKey = gameState.currentBallSide === 'left' ? 'G' : 'H';
                const wrongSide = gameState.currentBallSide === 'left' ? 'RIGHT' : 'LEFT';
                this.showFeedback(`Wrong side! This is a ${gameState.currentBallSide.toUpperCase()} ball - Press ${correctKey}!`, 'red');
            },

            missedBall: function(ball) {
                console.log('Ball missed!');
                gameState.ballActive = false;
                
                // Visual feedback
                ball.setAttribute('color', '#888888'); // Gray for missed
                ball.setAttribute('animation', {
                    property: 'scale',
                    to: '0.1 0.1 0.1',
                    dur: 500
                });

                this.showFeedback('MISSED! Too slow!', 'red');

                // Remove ball
                setTimeout(() => {
                    if (ball.parentNode) {
                        ball.parentNode.removeChild(ball);
                    }
                }, 500);

                this.nextBall();
            },

            nextBall: function() {
                gameState.currentBall = null;
                gameState.currentBallSide = null;

                if (gameState.ballsThrown >= gameState.totalBalls) {
                    this.endRound();
                } else {
                    setTimeout(() => {
                        this.clearFeedback();
                        this.spawnBall();
                    }, 1500);
                }
            },

            endRound: function() {
                const percentage = Math.round((gameState.score / gameState.totalBalls) * 100);
                console.log(`Round ${gameState.round} complete! Score: ${gameState.score}/${gameState.totalBalls} (${percentage}%)`);
                
                this.showFeedback(`Round Complete!\nScore: ${gameState.score}/${gameState.totalBalls} (${percentage}%)\nNext round starting...`, 'purple');

                // Reset for next round
                setTimeout(() => {
                    // Remove completion message
                    const completionMsg = document.querySelector('#completion-message');
                    if (completionMsg && completionMsg.parentNode) {
                        completionMsg.parentNode.removeChild(completionMsg);
                    }
                    
                    gameState.round++;
                    gameState.ballsThrown = 0;
                    gameState.score = 0;
                    this.updateUI();
                    this.clearFeedback();
                    this.startGame();
                }, 4000);
            },

            updateUI: function() {
                document.querySelector('#score-text').setAttribute('value', `Score: ${gameState.score}/${gameState.totalBalls}`);
                document.querySelector('#round-text').setAttribute('value', `Round ${gameState.round}`);
            },

            showFeedback: function(message, color) {
                const feedbackEl = document.querySelector('#feedback-text');
                feedbackEl.setAttribute('value', message);
                feedbackEl.setAttribute('color', color);
            },

            clearFeedback: function() {
                document.querySelector('#feedback-text').setAttribute('value', '');
            }
        });
    </script>

    <style>
        body {
            margin: 0;
            background: #000;
            font-family: Arial, sans-serif;
        }
        
        .desktop-instructions {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 20px;
            border-radius: 8px;
            font-size: 16px;
            z-index: 1000;
            line-height: 1.4;
        }

        .key-highlight {
            background: #333;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            color: #ffff00;
        }
    </style>

    <div class="desktop-instructions">
        <strong>Ball Catching Game</strong><br><br>
        
        <strong>Controls:</strong><br>
        • <span class="key-highlight">G</span> = Catch LEFT balls (blue)<br>
        • <span class="key-highlight">H</span> = Catch RIGHT balls (red)<br><br>
        
        <strong>Rules:</strong><br>
        • Watch which side the ball comes from<br>
        • Press the correct key quickly<br>
        • Wrong key = no points<br>
        • Too slow = missed ball<br><br>
        
        <strong>Goal:</strong> Catch 10 balls per round
    </div>
</body>
</html>
